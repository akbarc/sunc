<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Society Unlocked - Creators fuel culture</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Add Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Add Toast for notifications -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #000000;
            color: #ffffff;
            line-height: 1.6;
        }

        .page {
            display: none;
            min-height: 100vh;
        }

        .page.active {
            display: block;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: #ffffff;
        }

        .nav-button {
            background: none;
            border: none;
            color: #ffffff;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background 0.2s ease;
            margin-left: 0.5rem;
        }

        .nav-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .sign-in-button {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border: 1px solid #ffffff;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .sign-in-button:hover {
            background: #ffffff;
            color: #000000;
        }

        /* Landing Page */
        .hero-section {
            background: #000;
            color: white;
            padding: 120px 20px 80px;
            text-align: center;
            min-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-content {
            max-width: 900px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }

        .logo-icon {
            font-size: 2.5rem;
            margin-right: 15px;
        }

        .hero-title {
            font-size: 4rem;
            font-weight: 300;
            margin-bottom: 20px;
            line-height: 1.1;
            text-transform: lowercase;
        }

        .hero-subtitle {
            font-size: 1.8rem;
            margin-bottom: 20px;
            font-weight: 300;
            text-transform: lowercase;
        }

        .hero-description {
            font-size: 1.2rem;
            margin-bottom: 40px;
            line-height: 1.6;
            opacity: 0.8;
            text-transform: lowercase;
        }

        .hero-image {
            margin-top: 40px;
        }

        .nyc-skyline {
            font-size: 1.5rem;
            font-weight: 600;
            opacity: 0.7;
        }

        .propose-section {
            padding: 100px 20px;
            background: white;
        }

        .section-title {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 60px;
            color: #333;
            letter-spacing: 2px;
        }

        .propose-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 60px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .propose-card {
            text-align: center;
        }

        .propose-number {
            font-size: 3rem;
            font-weight: 700;
            color: #000;
            margin-bottom: 20px;
        }

        .propose-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .propose-description {
            color: #666;
            line-height: 1.7;
            font-size: 1.1rem;
        }

        .why-works-section {
            padding: 100px 20px;
            background: #f8f9fa;
        }

        .why-works-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .why-works-icon {
            font-size: 3rem;
            margin-bottom: 30px;
        }

        .why-works-title {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 30px;
            color: #333;
        }

        .why-works-text {
            font-size: 1.2rem;
            line-height: 1.8;
            color: #666;
            margin-bottom: 20px;
        }

        .join-section {
            padding: 100px 20px;
            background: white;
            text-align: center;
        }

        .join-title {
            font-size: 3rem;
            font-weight: 300;
            margin-bottom: 20px;
            color: #333;
            text-transform: lowercase;
        }

        .join-subtitle {
            font-size: 1.3rem;
            margin-bottom: 50px;
            color: #666;
            text-transform: lowercase;
        }

        .join-question {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: #333;
        }

        .join-buttons {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .join-button {
            background: #000;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .join-button:hover {
            background: #333;
            transform: translateY(-2px);
        }

        .cta-button:hover {
            background: #0052cc !important;
            transform: translateY(-2px);
        }

        .newsletter-section {
            padding: 80px 20px;
            background: #f8f9fa;
            text-align: center;
        }

        .newsletter-title {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: #333;
        }

        .newsletter-form {
            display: flex;
            gap: 15px;
            justify-content: center;
            max-width: 500px;
            margin: 0 auto 30px;
            flex-wrap: wrap;
        }

        .newsletter-input {
            flex: 1;
            min-width: 250px;
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .newsletter-button {
            background: #000;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 5px;
        }

        .newsletter-button:hover {
            background: #333;
        }

        .social-links {
            margin-top: 20px;
        }

        .social-link {
            font-size: 1.5rem;
            text-decoration: none;
            color: #333;
        }

        .footer {
            padding: 40px 20px;
            background: #000;
            color: white;
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-links {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .footer-link {
            color: #999;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .footer-link:hover {
            color: white;
        }

        .footer-copyright {
            color: #666;
            font-size: 0.9rem;
        }

        /* Application Page */
        .application-container {
            min-height: 100vh;
            background: #000000;
            padding: 2rem;
            padding-top: 6rem;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .benefits-column {
            background: #111111;
            padding: 2rem;
            border-radius: 12px;
            height: fit-content;
        }

        .benefits-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #0066ff;
        }

        .benefit-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: rgba(0, 102, 255, 0.1);
            border-radius: 8px;
            border-left: 3px solid #0066ff;
        }

        .form-column {
            background: #111111;
            padding: 2rem;
            border-radius: 12px;
        }

        .form-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #333333;
            border-radius: 6px;
            background: #000000;
            color: #ffffff;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #0066ff;
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #333333;
            border-radius: 6px;
            background: #000000;
            color: #ffffff;
            font-size: 1rem;
        }

        .submit-button {
            background: #0066ff;
            color: #ffffff;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .submit-button:hover {
            background: #0052cc;
        }

        /* Dashboard */
        .dashboard-container {
            min-height: 100vh;
            background: #000000;
            padding-top: 5rem;
        }

        .dashboard-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #333333;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .event-card {
            background: #111111;
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s ease;
            border: 1px solid #333333;
        }

        .event-card:hover {
            transform: translateY(-4px);
        }

        .event-image {
            height: 200px;
            background: linear-gradient(45deg, #333333, #666666);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .event-content {
            padding: 1.5rem;
        }

        .venue-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .event-hook {
            color: #cccccc;
            margin-bottom: 1rem;
        }

        .capacity-meter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .capacity-text {
            font-size: 0.9rem;
            color: #666666;
        }

        .capacity-bar {
            width: 100px;
            height: 6px;
            background: #333333;
            border-radius: 3px;
            overflow: hidden;
        }

        .capacity-fill {
            height: 100%;
            background: #00cc66;
            width: 60%;
            transition: width 0.3s ease;
        }

        .event-button {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #0066ff;
            color: #ffffff;
        }

        .event-button:hover {
            background: #0052cc;
        }

        .profile-panel {
            background: #111111;
            border-radius: 12px;
            padding: 1.5rem;
            height: fit-content;
            border: 1px solid #333333;
        }

        .profile-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .profile-section {
            margin-bottom: 2rem;
        }

        .profile-label {
            font-size: 0.9rem;
            color: #666666;
            margin-bottom: 0.5rem;
        }

        .profile-value {
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            background: rgba(0, 204, 102, 0.2);
            color: #00cc66;
        }

        /* Success Page */
        .success-container {
            min-height: 100vh;
            background: #000000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .success-card {
            background: #111111;
            padding: 3rem;
            border-radius: 12px;
            text-align: center;
            max-width: 500px;
            width: 100%;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: #00cc66;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            color: #ffffff;
            font-size: 2rem;
        }

        .success-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #00cc66;
        }

        .success-message {
            font-size: 1.1rem;
            color: #cccccc;
            margin-bottom: 2rem;
        }

        /* Admin Console */
        .admin-container {
            min-height: 100vh;
            background: #000000;
            padding: 2rem;
            padding-top: 6rem;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #333333;
        }

        .admin-title {
            font-size: 2rem;
            font-weight: 700;
        }

        .admin-nav {
            display: flex;
            gap: 1rem;
        }

        .admin-nav-button {
            background: none;
            border: none;
            color: #666666;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .admin-nav-button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .admin-nav-button.active {
            background: #0066ff;
            color: #ffffff;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #111111;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #333333;
        }

        .stat-card h3 {
            font-size: 1rem;
            color: #666666;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }

        /* Applications Section */
        .applications-grid {
            display: grid;
            gap: 1.5rem;
        }

        .application-card {
            background: #111111;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #333333;
        }

        .application-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .application-name {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .application-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .application-status.pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .application-status.approved {
            background: rgba(0, 204, 102, 0.2);
            color: #00cc66;
        }

        .application-status.denied {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }

        /* Members Section */
        .members-grid {
            display: grid;
            gap: 1.5rem;
        }

        .member-card {
            background: #111111;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #333333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .member-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .member-avatar {
            width: 48px;
            height: 48px;
            background: #0066ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #ffffff;
        }

        .member-details h3 {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .member-details p {
            color: #666666;
            font-size: 0.9rem;
        }

        /* Events Section */
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .event-management-card {
            background: #111111;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #333333;
        }

        .event-management-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .event-management-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .event-management-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            padding: 2rem;
            overflow-y: auto;
        }

        .modal-content {
            background: #111111;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            margin: 2rem auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .close-button {
            background: none;
            border: none;
            color: #666666;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #666666;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            background: #000000;
            border: 1px solid #333333;
            border-radius: 6px;
            color: #ffffff;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .submit-button,
        .approve-button,
        .deny-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .submit-button {
            background: #0066ff;
            color: #ffffff;
        }

        .approve-button {
            background: #00cc66;
            color: #ffffff;
        }

        .deny-button {
            background: #ff4444;
            color: #ffffff;
        }

        /* Toast Container */
        #toastContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
        }

        /* Missing admin styles */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem 0;
        }

        .filter-group select,
        .search-group input {
            background: #111111;
            border: 1px solid #333333;
            color: #ffffff;
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 1rem;
        }

        .action-button {
            background: #0066ff;
            color: #ffffff;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-button:hover {
            background: #0052cc;
        }

        .review-button {
            background: #0066ff;
            color: #ffffff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .review-button:hover {
            background: #0052cc;
        }

        .ban-button {
            background: #ff4444;
            color: #ffffff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .ban-button:hover {
            background: #cc3333;
        }

        .application-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .application-detail {
            color: #cccccc;
        }

        .application-detail strong {
            color: #ffffff;
        }

        .application-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .member-actions {
            display: flex;
            gap: 0.5rem;
        }

        .event-management-actions {
            display: flex;
            gap: 0.5rem;
        }

        .event-management-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .event-management-detail {
            color: #cccccc;
        }

        .event-management-detail strong {
            color: #ffffff;
        }

        /* Auth Modal Styles */
        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #666666;
            z-index: 1;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            padding-left: 2.5rem;
            padding-right: 2.5rem;
            border: 1px solid #333333;
            border-radius: 6px;
            background: #000000;
            color: #ffffff;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #0066ff;
        }

        .password-toggle {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666666;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: color 0.2s ease;
            z-index: 1;
        }

        .password-toggle:hover {
            color: #ffffff;
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: #666666;
            font-size: 0.9rem;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #333333;
        }

        .divider span {
            padding: 0 1rem;
        }

        .instagram-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            color: #ffffff;
            border: none;
            padding: 0.75rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .instagram-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 39, 67, 0.3);
        }

        .forgot-link {
            background: none;
            border: none;
            color: #0066ff;
            cursor: pointer;
            font-size: 0.9rem;
            text-align: center;
            margin-top: 0.5rem;
            width: 100%;
        }

        .forgot-link:hover {
            text-decoration: underline;
        }

        .signup-prompt {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #333333;
            color: #666666;
            font-size: 0.9rem;
        }

        .signup-link {
            background: none;
            border: none;
            color: #0066ff;
            cursor: pointer;
            font-weight: 500;
        }

        .signup-link:hover {
            text-decoration: underline;
        }

        #authMessage {
            background: #1a4b3a;
            border: 1px solid #2d8659;
            color: #4ade80;
        }

        #authMessage.error {
            background: #4b1a1a;
            border: 1px solid #86292d;
            color: #f87171;
        }

        #authMessage.warning {
            background: #4b3a1a;
            border: 1px solid #d97706;
            color: #fbbf24;
        }

        /* Join Modal Styles */
        .guidelines-list {
            list-style: none;
            padding: 0;
            margin: 0 0 1.5rem 0;
        }

        .guideline-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #333333;
            color: #cccccc;
        }

        .guideline-item:last-child {
            border-bottom: none;
        }

        .guideline-item::before {
            content: '✓';
            color: #00cc66;
            font-weight: bold;
            margin-right: 0.5rem;
        }

        .penalty-clause {
            background: #4b1a1a;
            border: 1px solid #86292d;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            color: #f87171;
            font-size: 0.9rem;
        }

        .checkbox-container {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .guidelines-checkbox {
            margin-top: 0.125rem;
        }

        .checkbox-container label {
            color: #cccccc;
            font-size: 0.9rem;
            line-height: 1.4;
            cursor: pointer;
        }

        .modal-button {
            width: 100%;
            padding: 0.75rem;
            background: #0066ff;
            color: #ffffff;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-button:hover:not(:disabled) {
            background: #0052cc;
        }

        .modal-button:disabled {
            background: #666666;
            cursor: not-allowed;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .table-header,
            .table-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div class="header">
        <div class="logo">Society Unlocked</div>
        <div>
            <button class="nav-button" onclick="showPage('landing')">Home</button>
            <button class="nav-button" onclick="showPage('apply')">Apply</button>
            <button class="nav-button" onclick="showPage('dashboard')">Dashboard</button>
                            <button class="nav-button" onclick="showPage('admin-page')">Admin</button>
            <a href="#" class="sign-in-button" onclick="openAuthModal()">Sign In</a>
        </div>
    </div>

    <!-- Landing Page -->
    <div id="landing" class="page active">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-content">
                <div class="logo-container">
                    <div class="logo-icon">🔓</div>
                    <h1 class="hero-title">society unlocked.</h1>
                </div>
                <p class="hero-subtitle">your key to unlocking New York City</p>
                <p class="hero-description">a gateway that connects the city's most exciting venues with authentic & engaging locals to deliver real results</p>
                <button class="cta-button" onclick="showPage('apply')" style="margin: 2rem 0; padding: 1rem 2rem; background: #0066ff; color: #ffffff; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease;">
                    Apply to Join Society Unlocked
                </button>
                <div class="hero-image">
                    <div class="nyc-skyline">NYC Skyline BW</div>
                </div>
            </div>
        </div>

        <!-- What We Propose Section -->
        <div class="propose-section">
            <h2 class="section-title">WHAT WE PROPOSE</h2>
            <div class="propose-grid">
                <div class="propose-card">
                    <div class="propose-number">1</div>
                    <h3 class="propose-title">Join the Society</h3>
                    <p class="propose-description">Whether you're a venue looking to elevate your presence or an NYC local ready to take your influence to new heights, apply to join our exclusive community.</p>
                </div>
                <div class="propose-card">
                    <div class="propose-number">2</div>
                    <h3 class="propose-title">Unlock Opportunities</h3>
                    <p class="propose-description">We'll analyze your brand and value proposition to connect our exclusive venues with the right micro-influencers to join forces.</p>
                </div>
                <div class="propose-card">
                    <div class="propose-number">3</div>
                    <h3 class="propose-title">Socialize & Share</h3>
                    <p class="propose-description">Micro-influencers will create authentic, user-generated content for their venues that resonate with its target audience, increasing brand awareness and unlocking your potential.</p>
                </div>
            </div>
        </div>

        <!-- Why It Works Section -->
        <div class="why-works-section">
            <div class="why-works-content">
                <div class="why-works-icon">🎸</div>
                <h3 class="why-works-title">The future of UGC is now.</h3>
                <p class="why-works-text">Long gone are the days of celebrity promotions and paid partnerships. Consumers crave authenticity.</p>
                <p class="why-works-text">Exclusive partnerships between micro-influencers and venues in the hospitality industry will unlock the power of authentic, localized influence to elevate a venue's presence in the city and enhance brand visibility.</p>
                <p class="why-works-text">Micro-influencers connect with their audiences and use user-generated content to provide compelling social proof that will increase bookings and customer engagement.</p>
            </div>
        </div>

        <!-- Join the Society Section -->
        <div class="join-section">
            <h2 class="join-title">Join the society.</h2>
            <p class="join-subtitle">anyone can apply, but not everyone can join...</p>
            <div class="join-options">
                <h3 class="join-question">Who are you?</h3>
                <div class="join-buttons">
                    <button class="join-button venue" onclick="showPage('apply')">VENUE</button>
                    <button class="join-button influencer" onclick="showPage('apply')">MICRO-INFLUENCER</button>
                </div>
            </div>
        </div>

        <!-- Newsletter Section -->
        <div class="newsletter-section">
            <h3 class="newsletter-title">Interested? Be in the know:</h3>
            <form class="newsletter-form" onsubmit="handleNewsletterSignup(event)">
                <input type="email" class="newsletter-input" placeholder="Enter your email here" required>
                <button type="submit" class="newsletter-button">Sign Up</button>
            </form>
            <div class="social-links">
                <a href="https://instagram.com/societyunlocked" class="social-link">📷</a>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="#" class="footer-link">HOME</a>
                    <a href="#" class="footer-link">VENUE</a>
                    <a href="#" class="footer-link">MICRO-INFLUENCER</a>
                    <a href="#" class="footer-link">PRESS</a>
                    <a href="#" class="footer-link">CONTACT</a>
                </div>
                <div class="footer-copyright">
                    © 2024 By Society Unlocked.
                </div>
            </div>
        </div>
    </div>

    <!-- Application Page -->
    <div id="apply" class="page">
        <div class="application-container">
            <div class="content-grid">
                <div class="benefits-column">
                    <h2 class="benefits-title">What You'll Get</h2>
                    <div class="benefit-item">
                        <span>🎁</span>
                        <span>Free meals at exclusive venues</span>
                    </div>
                    <div class="benefit-item">
                        <span>⭐</span>
                        <span>Priority access to events</span>
                    </div>
                    <div class="benefit-item">
                        <span>👥</span>
                        <span>Exclusive drops and perks</span>
                    </div>
                </div>

                <div class="form-column">
                    <h2 class="form-title">Creator Profile</h2>
                    <form onsubmit="submitApplication(event)">
                        <div class="form-group">
                            <label class="form-label">Full Name *</label>
                            <input type="text" name="fullName" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input type="email" name="email" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone Number *</label>
                            <input type="tel" name="phone" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Instagram Handle *</label>
                            <input type="text" name="instagram" class="form-input" placeholder="@yourhandle" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Instagram Followers *</label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <select name="followerCount" class="form-select" required style="flex: 1;">
                                    <option value="">Select your follower count</option>
                                    <option value="1k-5k">1K - 5K</option>
                                    <option value="5k-10k">5K - 10K</option>
                                    <option value="10k-25k">10K - 25K</option>
                                    <option value="25k-50k">25K - 50K</option>
                                    <option value="50k-100k">50K - 100K</option>
                                    <option value="100k+">100K+</option>
                                </select>
                                <div style="background: rgba(0, 102, 255, 0.1); border: 1px solid #0066ff; border-radius: 4px; padding: 0.5rem; cursor: help;" title="This refers to your Instagram follower count only">
                                    <span style="color: #0066ff; font-size: 0.8rem;">ℹ️</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Content Category *</label>
                            <select name="contentCategory" class="form-select" required>
                                <option value="">Select your content category</option>
                                <option value="lifestyle">Lifestyle</option>
                                <option value="food">Food & Dining</option>
                                <option value="fashion">Fashion</option>
                                <option value="travel">Travel</option>
                                <option value="entertainment">Entertainment</option>
                                <option value="business">Business</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">City *</label>
                            <input type="text" name="city" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Why do you want to join? *</label>
                            <textarea name="motivation" class="form-input" rows="4" required placeholder="Tell us why you want to be part of Society Unlocked..."></textarea>
                        </div>
                        <button type="submit" class="submit-button">Submit Application</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Page -->
    <div id="success" class="page">
        <div class="success-container">
            <div class="success-card">
                <div class="success-icon">✓</div>
                <h1 class="success-title">Application Submitted!</h1>
                <p class="success-message">We're reviewing your profile. You'll hear from us soon.</p>
                <div style="background: rgba(0, 102, 255, 0.1); border: 1px solid #0066ff; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
                    <h3 style="color: #0066ff; margin-bottom: 0.5rem;">Stay Connected</h3>
                    <p style="color: #cccccc; font-size: 0.9rem; margin-bottom: 1rem;">Follow @SocietyUnlocked on Instagram while you wait for updates</p>
                    <a href="https://instagram.com/societyunlocked" style="display: inline-flex; align-items: center; gap: 0.5rem; background: #0066ff; color: #ffffff; text-decoration: none; padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500;">
                        📷 Follow @SocietyUnlocked
                    </a>
                </div>
                <button class="cta-button" onclick="showPage('landing')">Back to Home</button>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="page">
        <div class="dashboard-container">
            <div class="dashboard-header">
                <div class="logo">Society Unlocked</div>
                <div>
                    <button class="nav-button" style="background: #0066ff;">Events</button>
                    <button class="nav-button">Profile</button>
                    <div style="width: 40px; height: 40px; background: #0066ff; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: #ffffff; font-weight: 600;">JD</div>
                </div>
            </div>

            <div class="main-content">
                <div class="events-grid">
                    <div class="event-card">
                        <div class="event-image">The Grand</div>
                        <div class="event-content">
                            <h3 class="venue-name">The Grand</h3>
                            <p class="event-hook">Craft cocktails & dim sum launch</p>
                            <div class="capacity-meter">
                                <span class="capacity-text">7/12 spots left</span>
                                <div class="capacity-bar">
                                    <div class="capacity-fill"></div>
                                </div>
                            </div>
                            <button class="event-button">Join</button>
                        </div>
                    </div>

                    <div class="event-card">
                        <div class="event-image">Skyline Lounge</div>
                        <div class="event-content">
                            <h3 class="venue-name">Skyline Lounge</h3>
                            <p class="event-hook">Sunset rooftop networking</p>
                            <div class="capacity-meter">
                                <span class="capacity-text">8/8 spots left</span>
                                <div class="capacity-bar">
                                    <div class="capacity-fill" style="width: 100%; background: #ff4444;"></div>
                                </div>
                            </div>
                            <button class="event-button" style="background: #666666;" disabled>Full</button>
                        </div>
                    </div>

                    <div class="event-card">
                        <div class="event-image">Underground</div>
                        <div class="event-content">
                            <h3 class="venue-name">Underground</h3>
                            <p class="event-hook">Live jazz & art showcase</p>
                            <div class="capacity-meter">
                                <span class="capacity-text">5/15 spots left</span>
                                <div class="capacity-bar">
                                    <div class="capacity-fill" style="width: 33%;"></div>
                                </div>
                            </div>
                            <button class="event-button">Join</button>
                        </div>
                    </div>
                </div>

                <div class="profile-panel">
                    <h2 class="profile-title">Creator Profile</h2>
                    
                    <div class="profile-section">
                        <div class="profile-label">Instagram Followers</div>
                        <div class="profile-value">24.5K</div>
                        <div class="status-badge">✓ Active Creator</div>
                    </div>

                    <div class="profile-section">
                        <div class="profile-label">Status</div>
                        <div class="status-badge">⭐ 0 no-shows</div>
                        <div class="status-badge">👥 12 events attended</div>
                    </div>

                    <div class="profile-section">
                        <div class="profile-label">Recent Deliverables</div>
                        <div style="background: #000000; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #0066ff; font-size: 0.9rem; margin-bottom: 0.5rem;">
                            <strong>The Grand</strong> - Posted 2 days ago
                        </div>
                        <div style="background: #000000; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #0066ff; font-size: 0.9rem; margin-bottom: 0.5rem;">
                            <strong>Skyline Lounge</strong> - Posted 1 week ago
                        </div>
                        <div style="background: #000000; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #0066ff; font-size: 0.9rem;">
                            <strong>Underground</strong> - Posted 2 weeks ago
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Console -->
    <div id="admin-page" class="page">
        <div class="admin-container">
            <div class="admin-header">
                <h1 class="admin-title">Admin Console</h1>
                <div class="admin-nav">
                    <button class="admin-nav-button active" onclick="showAdminSection('dashboard')">Dashboard</button>
                    <button class="admin-nav-button" onclick="showAdminSection('applications')">Applications</button>
                    <button class="admin-nav-button" onclick="showAdminSection('members')">Members</button>
                    <button class="admin-nav-button" onclick="showAdminSection('events')">Events</button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="admin-dashboard" class="admin-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Events</h3>
                        <div id="total-events" class="stat-value">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Members</h3>
                        <div id="total-members" class="stat-value">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Pending Applications</h3>
                        <div id="pending-applications" class="stat-value">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Active Events</h3>
                        <div id="active-events" class="stat-value">0</div>
                    </div>
                </div>
            </div>

            <!-- Applications Section -->
            <div id="admin-applications" class="admin-section">
                <div class="section-header">
                    <div class="filter-group">
                        <select id="application-filter" onchange="filterApplications()">
                            <option value="all">All Applications</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="denied">Denied</option>
                        </select>
                    </div>
                </div>
                <div id="applications-list" class="applications-grid"></div>
            </div>

            <!-- Members Section -->
            <div id="admin-members" class="admin-section">
                <div class="section-header">
                    <div class="search-group">
                        <input type="text" id="member-search" placeholder="Search members..." onkeyup="searchMembers()">
                    </div>
                </div>
                <div id="members-list" class="members-grid"></div>
            </div>

            <!-- Events Section -->
            <div id="admin-events" class="admin-section">
                <div class="section-header">
                    <button class="action-button" onclick="openAddEventModal()">Add New Event</button>
                </div>
                <div id="events-list" class="events-grid"></div>
            </div>
        </div>
    </div>

    <!-- Application Review Modal -->
    <div id="applicationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Review Application</h2>
                <button class="close-button" onclick="closeApplicationModal()">&times;</button>
            </div>
            <div id="application-details"></div>
            <div class="review-form">
                <textarea id="review-notes" placeholder="Add review notes..."></textarea>
                <div class="modal-actions">
                    <button class="deny-button" onclick="denyApplication()">Deny</button>
                    <button class="approve-button" onclick="approveApplication()">Approve</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Event</h2>
                <button class="close-button" onclick="closeAddEventModal()">&times;</button>
            </div>
            <form onsubmit="submitNewEvent(event)">
                <div class="form-group">
                    <label for="venue">Venue Name</label>
                    <input type="text" id="venue" name="venue" required>
                </div>
                <div class="form-group">
                    <label for="hook">Hook</label>
                    <input type="text" id="hook" name="hook" required>
                </div>
                <div class="form-group">
                    <label for="date">Date</label>
                    <input type="date" id="date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="capacity">Capacity</label>
                    <input type="number" id="capacity" name="capacity" required min="1">
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" required></textarea>
                </div>
                <div class="form-group">
                    <label for="location_address">Location Address</label>
                    <input type="text" id="location_address" name="location_address" required>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="submit-button">Create Event</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Event Modal -->
    <div id="editEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Event</h2>
                <button class="close-button" onclick="document.getElementById('editEventModal').style.display='none'">&times;</button>
            </div>
            <form id="editEventForm" onsubmit="updateEvent(event)">
                <input type="hidden" name="id">
                <div class="form-group">
                    <label for="edit-venue">Venue Name</label>
                    <input type="text" id="edit-venue" name="venue" required>
                </div>
                <div class="form-group">
                    <label for="edit-hook">Hook</label>
                    <input type="text" id="edit-hook" name="hook" required>
                </div>
                <div class="form-group">
                    <label for="edit-date">Date</label>
                    <input type="date" id="edit-date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="edit-capacity">Capacity</label>
                    <input type="number" id="edit-capacity" name="capacity" required min="1">
                </div>
                <div class="form-group">
                    <label for="edit-description">Description</label>
                    <textarea id="edit-description" name="description" required></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-location_address">Location Address</label>
                    <input type="text" id="edit-location_address" name="location_address" required>
                </div>
                <div class="form-group">
                    <label for="edit-status">Status</label>
                    <select id="edit-status" name="status" required>
                        <option value="active">Active</option>
                        <option value="cancelled">Cancelled</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="submit-button">Update Event</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Event Participants Modal -->
    <div id="eventParticipantsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Event Participants</h2>
                <button class="close-button" onclick="document.getElementById('eventParticipantsModal').style.display='none'">&times;</button>
            </div>
            <div id="event-participants-list"></div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="modal" style="display: none;">
        <div class="modal-content">
            <button class="close-button" onclick="closeAuthModal()">✕</button>
            <h2 class="modal-title" id="authTitle">Sign In</h2>
            
            <div id="authMessage" style="padding: 1rem; margin-bottom: 1rem; border-radius: 6px; display: none;">
                <p id="authMessageText"></p>
            </div>
            
            <form id="authForm" onsubmit="handleAuthSubmit(event)">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <div class="input-wrapper">
                        <div class="input-icon">📧</div>
                        <input type="email" class="form-input" id="authEmail" required placeholder="your@email.com">
                    </div>
                </div>
                
                <div class="form-group" id="passwordGroup">
                    <label class="form-label" id="passwordLabel">Password</label>
                    <div class="input-wrapper">
                        <div class="input-icon">🔒</div>
                        <input type="password" class="form-input" id="authPassword" required placeholder="Enter your password">
                        <button type="button" class="password-toggle" onclick="togglePassword()">👁️</button>
                    </div>
                </div>
                
                <div class="form-group" id="confirmPasswordGroup" style="display: none;">
                    <label class="form-label">Confirm Password</label>
                    <div class="input-wrapper">
                        <div class="input-icon">🔒</div>
                        <input type="password" class="form-input" id="authConfirmPassword" placeholder="Confirm your password">
                        <button type="button" class="password-toggle" onclick="toggleConfirmPassword()">👁️</button>
                    </div>
                </div>
                
                <button type="submit" class="submit-button" id="authSubmitButton">Sign In</button>
                <button type="button" class="forgot-link" onclick="handleForgotPassword()">Forgot password?</button>
            </form>
            
            <div class="divider">
                <span>or</span>
            </div>
            
            <button class="instagram-button" onclick="handleInstagramLogin()">
                📷 Log in with Instagram
            </button>
            
            <div class="signup-prompt">
                Don't have an account? 
                <button type="button" class="signup-link" onclick="showPage('apply')">Apply to join</button>
            </div>
        </div>
    </div>

    <!-- Join Confirmation Modal -->
    <div id="joinModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Join Event</h2>
                <button class="close-button" onclick="closeJoinModal()">✕</button>
            </div>
            
            <div id="joinModalContent">
                <h3 id="eventVenue" style="margin-bottom: 1rem;"></h3>
                <p id="eventHook" style="color: #cccccc; margin-bottom: 1.5rem;"></p>
                
                <h4 style="margin-bottom: 1rem;">Guidelines</h4>
                <ul class="guidelines-list">
                    <li class="guideline-item">Post at least one Instagram story during the event</li>
                    <li class="guideline-item">Share a Google Review within 48 hours</li>
                    <li class="guideline-item">Tag @SocietyUnlocked in your content</li>
                </ul>
                
                <div class="penalty-clause">
                    <strong>Penalty:</strong> No-shows or failure to complete deliverables may result in suspension from future events.
                </div>
                
                <div class="checkbox-container">
                    <input type="checkbox" id="guidelinesCheck" class="guidelines-checkbox">
                    <label for="guidelinesCheck">
                        I accept the guidelines and understand the penalty clause
                    </label>
                </div>
                
                <button class="modal-button" onclick="confirmJoin()" disabled id="confirmJoinButton">
                    Accept & Reserve
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        // Global variables
        let selectedEvent = null;
        let currentUser = null;
        let currentAdminSection = 'dashboard';

        // Initialize Supabase client
        const { createClient } = supabase;
        const supabaseClient = createClient(
            'https://vdwarnobmgkljagpvttv.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZkd2Fybm9ibWdrbGphZ3B2dHR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1MDc5MDUsImV4cCI6MjA2NzA4MzkwNX0.xH0T_JtxngQjodqGxQlH-waRuNlFv4aXLY_glhwB8zQ'
        );

        // Toast notification helper
        function showToast(message, type = 'info') {
            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "right",
                style: {
                    background: type === 'error' ? "#ff4b4b" : "#00b894"
                }
            }).showToast();
        }

        // Page navigation
        function showPage(pageId) {
            console.log('🔄 Showing page:', pageId);
            const pages = document.querySelectorAll('.page');
            const targetPage = document.getElementById(pageId);
            
            console.log('📄 Available pages:', Array.from(pages).map(p => p.id));
            console.log('🎯 Target page found:', !!targetPage);
            
            if (!targetPage) {
                console.error('❌ Page not found:', pageId);
                console.log('Available page IDs:', Array.from(document.querySelectorAll('.page')).map(p => p.id));
                return;
            }
            
            pages.forEach(page => {
                page.classList.remove('active');
                console.log('📵 Hiding page:', page.id);
            });
            
            targetPage.classList.add('active');
            console.log('✅ Showing page:', pageId);
            
            // Load page-specific data
            if (pageId === 'dashboard') {
                loadDashboardEvents();
            } else if (pageId === 'admin-page') {
                loadDashboardStats();
                loadApplications();
                loadMembers();
                loadEvents();
            }
            
            // Update URL hash
            window.location.hash = pageId;
            console.log('🔗 Updated hash to:', window.location.hash);
        }

        // Authentication State
        let isCreatingAccount = false;
        let approvedApplication = null;

        // Authentication functions
        function openAuthModal() {
            document.getElementById('authModal').style.display = 'flex';
            resetAuthModal();
        }

        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
            resetAuthModal();
        }

        function resetAuthModal() {
            isCreatingAccount = false;
            approvedApplication = null;
            document.getElementById('authTitle').textContent = 'Sign In';
            document.getElementById('passwordLabel').textContent = 'Password';
            document.getElementById('authSubmitButton').textContent = 'Sign In';
            document.getElementById('confirmPasswordGroup').style.display = 'none';
            document.getElementById('authPassword').required = true;
            hideAuthMessage();
            document.getElementById('authForm').reset();
        }

        function showAuthMessage(message, type = 'info') {
            const messageDiv = document.getElementById('authMessage');
            const messageText = document.getElementById('authMessageText');
            
            messageDiv.className = type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
            messageText.textContent = message;
            messageDiv.style.display = 'block';
        }

        function hideAuthMessage() {
            document.getElementById('authMessage').style.display = 'none';
        }

        function togglePassword() {
            const passwordInput = document.getElementById('authPassword');
            const toggleButton = document.querySelector('.password-toggle');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.textContent = '🙈';
            } else {
                passwordInput.type = 'password';
                toggleButton.textContent = '👁️';
            }
        }

        function toggleConfirmPassword() {
            const passwordInput = document.getElementById('authConfirmPassword');
            const toggleButtons = document.querySelectorAll('.password-toggle');
            const confirmToggle = toggleButtons[1]; // Second toggle button
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                confirmToggle.textContent = '🙈';
            } else {
                passwordInput.type = 'password';
                confirmToggle.textContent = '👁️';
            }
        }

        async function handleAuthSubmit(event) {
            event.preventDefault();
            const email = document.getElementById('authEmail').value.trim().toLowerCase();
            const password = document.getElementById('authPassword').value;
            const confirmPassword = document.getElementById('authConfirmPassword').value;
            
            console.log('🔐 Auth submit:', { email, isCreatingAccount });
            
            // Show loading state
            const submitButton = document.getElementById('authSubmitButton');
            const originalText = submitButton.textContent;
            submitButton.textContent = isCreatingAccount ? 'Creating Account...' : 'Signing In...';
            submitButton.disabled = true;
            
            try {
                if (isCreatingAccount) {
                    // Validate password confirmation
                    if (password !== confirmPassword) {
                        showAuthMessage('Passwords do not match', 'error');
                        return;
                    }
                    
                    if (password.length < 6) {
                        showAuthMessage('Password must be at least 6 characters', 'error');
                        return;
                    }
                    
                    // Create the user account
                    await createUserAccount(email, password, approvedApplication);
                } else {
                    // Check if email exists in approved applications
                    const application = await checkApprovedApplication(email);
                    
                    if (!application) {
                        showAuthMessage('Email not found. Please apply first or contact support.', 'error');
                        return;
                    }
                    
                    // Try to sign in with existing account
                    try {
                        await signInUser(email, password);
                    } catch (signInError) {
                        // If sign in fails, this might be their first time - offer to create account
                        if (signInError.message.includes('Invalid login credentials') || 
                            signInError.message.includes('Email not confirmed')) {
                            await promptPasswordSetup(email, application);
                            return;
                        }
                        throw signInError;
                    }
                }
            } catch (error) {
                console.error('❌ Authentication error:', error);
                showAuthMessage(error.message || 'Authentication failed. Please try again.', 'error');
            } finally {
                // Reset button
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        }

        async function checkApprovedApplication(email) {
            console.log('🔍 Checking approved application for:', email);
            
            try {
                const { data: applications, error } = await supabaseClient
                    .from('applications')
                    .select('*')
                    .eq('email', email)
                    .eq('status', 'approved')
                    .single();
                
                if (error && error.code !== 'PGRST116') { // PGRST116 = no rows returned
                    console.error('❌ Error checking application:', error);
                    throw new Error('Failed to verify application status');
                }
                
                console.log('✅ Application check result:', applications);
                return applications;
            } catch (error) {
                console.error('❌ Error in checkApprovedApplication:', error);
                return null;
            }
        }

        async function promptPasswordSetup(email, application) {
            console.log('🔐 Prompting password setup for:', email);
            
            isCreatingAccount = true;
            approvedApplication = application;
            
            document.getElementById('authTitle').textContent = 'Set Your Password';
            document.getElementById('passwordLabel').textContent = 'Create Password';
            document.getElementById('authSubmitButton').textContent = 'Create Account';
            document.getElementById('confirmPasswordGroup').style.display = 'block';
            document.getElementById('authPassword').value = '';
            document.getElementById('authPassword').required = true;
            document.getElementById('authConfirmPassword').required = true;
            
            showAuthMessage(`Welcome ${application.full_name}! Please create a password for your account.`, 'info');
        }

        async function createUserAccount(email, password, application) {
            console.log('🚀 Creating user account for:', email);
            
            try {
                // Create user with Supabase Auth
                const { data: authData, error: authError } = await supabaseClient.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            full_name: application.full_name,
                            instagram_handle: application.instagram
                        }
                    }
                });
                
                if (authError) {
                    console.error('❌ Auth signup error:', authError);
                    throw authError;
                }
                
                console.log('✅ User created:', authData.user);
                
                // Create profile
                if (authData.user) {
                    await createUserProfile(authData.user.id, application);
                    
                    currentUser = {
                        id: authData.user.id,
                        email: authData.user.email,
                        name: application.full_name,
                        instagram: application.instagram,
                        application: application
                    };
                    
                    showToast('Account created successfully! Welcome to Society Unlocked!', 'success');
                    closeAuthModal();
                    showPage('dashboard');
                    updateUserInterface();
                }
            } catch (error) {
                console.error('❌ Account creation error:', error);
                throw error;
            }
        }

        async function createUserProfile(userId, application) {
            console.log('👤 Creating user profile for:', userId);
            
            try {
                // Check if this is the hardcoded admin email
                const isAdmin = application.email === 'hello@societyunlocked.com';
                
                const { data, error } = await supabaseClient
                    .from('profiles')
                    .insert([{
                        id: userId,
                        full_name: application.full_name,
                        instagram_handle: application.instagram,
                        follower_count: application.follower_count,
                        content_category: application.content_category,
                        city: application.city,
                        is_verified: true, // They're approved, so they're verified
                        is_admin: isAdmin, // Auto-admin for hello@societyunlocked.com
                        last_visit: new Date().toISOString()
                    }])
                    .select();
                
                if (error) {
                    console.error('❌ Profile creation error:', error);
                    throw error;
                }
                
                console.log('✅ Profile created:', data[0]);
                if (isAdmin) {
                    console.log('👑 Admin privileges granted for hello@societyunlocked.com');
                }
                return data[0];
            } catch (error) {
                console.error('❌ Error creating profile:', error);
                throw error;
            }
        }

        async function signInUser(email, password) {
            console.log('🔐 Signing in user:', email);
            
            try {
                const { data: authData, error: authError } = await supabaseClient.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (authError) {
                    console.error('❌ Sign in error:', authError);
                    throw authError;
                }
                
                console.log('✅ User signed in:', authData.user);
                
                // Get user profile
                const profile = await getUserProfile(authData.user.id);
                
                // Update last visit
                await updateLastVisit(authData.user.id);
                
                currentUser = {
                    id: authData.user.id,
                    email: authData.user.email,
                    name: profile.full_name || authData.user.user_metadata?.full_name,
                    instagram: profile.instagram_handle,
                    profile: profile
                };
                
                const isAdmin = profile.is_admin;
                const successMessage = isAdmin ? 'Signed in successfully with admin privileges!' : 'Signed in successfully!';
                showToast(successMessage, 'success');
                
                if (isAdmin) {
                    console.log('👑 Admin user signed in');
                }
                
                closeAuthModal();
                showPage('dashboard');
                updateUserInterface();
            } catch (error) {
                console.error('❌ Sign in error:', error);
                throw error;
            }
        }

        async function getUserProfile(userId) {
            console.log('👤 Getting user profile for:', userId);
            
            try {
                const { data: profile, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', userId)
                    .single();
                
                if (error && error.code !== 'PGRST116') {
                    console.error('❌ Profile fetch error:', error);
                    throw error;
                }
                
                console.log('✅ Profile fetched:', profile);
                return profile || {};
            } catch (error) {
                console.error('❌ Error getting profile:', error);
                return {};
            }
        }

        async function updateLastVisit(userId) {
            console.log('⏰ Updating last visit for:', userId);
            
            try {
                const { error } = await supabaseClient
                    .from('profiles')
                    .update({ 
                        last_visit: new Date().toISOString() 
                    })
                    .eq('id', userId);
                
                if (error) {
                    console.error('❌ Last visit update error:', error);
                }
            } catch (error) {
                console.error('❌ Error updating last visit:', error);
            }
        }

        async function signOutUser() {
            console.log('🔐 Signing out user');
            
            try {
                const { error } = await supabaseClient.auth.signOut();
                
                if (error) {
                    console.error('❌ Sign out error:', error);
                    throw error;
                }
                
                currentUser = null;
                showToast('Signed out successfully', 'success');
                showPage('landing');
                updateUserInterface();
            } catch (error) {
                console.error('❌ Error signing out:', error);
                showToast('Error signing out', 'error');
            }
        }

        function updateUserInterface() {
            // Update UI based on current user state
            const signInButton = document.querySelector('.sign-in-button');
            if (currentUser) {
                signInButton.textContent = 'Sign Out';
                signInButton.onclick = signOutUser;
            } else {
                signInButton.textContent = 'Sign In';
                signInButton.onclick = openAuthModal;
            }
        }

        function handleInstagramLogin() {
            showToast('Instagram login coming soon!', 'info');
        }

        function handleForgotPassword() {
            const email = document.getElementById('authEmail').value;
            if (!email) {
                showAuthMessage('Please enter your email address first', 'error');
                return;
            }
            
            showToast('Password reset feature coming soon! Contact support for help.', 'info');
        }

        async function handleNewsletterSignup(event) {
            event.preventDefault();
            const email = event.target.querySelector('input[type="email"]').value;
            
            console.log('📧 Newsletter signup for:', email);
            
            try {
                const { data, error } = await supabaseClient
                    .from('newsletter_subscribers')
                    .insert([{ email }])
                    .select();
                
                if (error) {
                    console.error('❌ Newsletter signup error:', error);
                    throw error;
                }
                
                console.log('✅ Newsletter signup successful:', data);
                showToast('Thanks for subscribing!', 'success');
                event.target.reset();
            } catch (error) {
                console.error('❌ Error subscribing:', error);
                showToast('Failed to subscribe: ' + error.message, 'error');
            }
        }

        // Application functions
        async function submitApplication(event) {
            event.preventDefault();
            console.log('📝 Submitting application...');
            
            const submitButton = event.target.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            
            // Show loading state
            submitButton.textContent = 'Submitting...';
            submitButton.disabled = true;
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);
            
            console.log('📋 Form data:', data);
            
            // Validate required fields
            const requiredFields = ['fullName', 'email', 'phone', 'instagram', 'followerCount', 'contentCategory', 'city', 'motivation'];
            const missingFields = requiredFields.filter(field => !data[field]);
            
            if (missingFields.length > 0) {
                console.log('❌ Missing fields:', missingFields);
                showToast('Please fill in all required fields: ' + missingFields.join(', '), 'error');
                
                // Reset button
                submitButton.textContent = originalText;
                submitButton.disabled = false;
                return;
            }
            
            try {
                // Submit to Supabase using the client
                const applicationData = {
                    full_name: data.fullName,
                    email: data.email,
                    phone: data.phone,
                    instagram: data.instagram,
                    follower_count: parseInt(data.followerCount.replace(/[^0-9]/g, '') || '0'),
                    content_category: data.contentCategory,
                    city: data.city,
                    motivation: data.motivation
                };
                
                console.log('🚀 Submitting to Supabase:', applicationData);
                
                const { data: result, error } = await supabaseClient
                    .from('applications')
                    .insert([applicationData])
                    .select();
                
                if (error) {
                    console.error('❌ Supabase error:', error);
                    throw error;
                }
                
                console.log('✅ Application submitted successfully:', result);
                showToast('Application submitted successfully!', 'success');
                showPage('success');
            } catch (error) {
                console.error('❌ Error submitting application:', error);
                showToast('Failed to submit application: ' + error.message, 'error');
                
                // Reset button on error
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        }

        // Join event functions
        function openJoinModal(eventData) {
            // Check if user is authenticated
            if (!currentUser) {
                showToast('Please sign in to join events', 'error');
                openAuthModal();
                return;
            }
            
            selectedEvent = eventData;
            document.getElementById('eventVenue').textContent = eventData.venue;
            document.getElementById('eventHook').textContent = eventData.hook;
            document.getElementById('joinModal').style.display = 'flex';
            
            // Reset form
            document.getElementById('guidelinesCheck').checked = false;
            document.getElementById('confirmJoinButton').disabled = true;
        }

        function closeJoinModal() {
            document.getElementById('joinModal').style.display = 'none';
            selectedEvent = null;
        }

        async function confirmJoin() {
            if (!selectedEvent || !currentUser) {
                showToast('Authentication required', 'error');
                return;
            }

            const submitButton = document.getElementById('confirmJoinButton');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Joining...';
            submitButton.disabled = true;

            try {
                // Create event participation record
                const { data, error } = await supabaseClient
                    .from('event_participants')
                    .insert([{
                        event_id: selectedEvent.id,
                        user_id: currentUser.id,
                        status: 'joined',
                        joined_at: new Date().toISOString()
                    }])
                    .select();

                if (error) {
                    if (error.code === '23505') { // Unique constraint violation
                        showToast('You have already joined this event!', 'warning');
                    } else {
                        console.error('❌ Error joining event:', error);
                        throw error;
                    }
                } else {
                    console.log('✅ Joined event successfully:', data[0]);
                    
                    // Update UI
                    const eventCard = document.querySelector(`[data-event-id="${selectedEvent.id}"]`);
                    if (eventCard) {
                        eventCard.classList.add('reserved');
                        const button = eventCard.querySelector('.event-button');
                        button.textContent = 'Upload Proof';
                        button.style.background = '#00cc66';
                        button.onclick = () => handleUploadProof(selectedEvent.id);
                    }
                    
                    showToast('Reserved. See you there!', 'success');
                }
                
                closeJoinModal();
            } catch (error) {
                console.error('❌ Error joining event:', error);
                showToast('Failed to join event: ' + error.message, 'error');
            } finally {
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        }

        function handleUploadProof(eventId) {
            showToast('Proof uploaded successfully!', 'success');
            
            const eventCard = document.querySelector(`[data-event-id="${eventId}"]`);
            if (eventCard) {
                eventCard.classList.remove('reserved');
                eventCard.classList.add('completed');
                const button = eventCard.querySelector('.event-button');
                button.textContent = 'Completed';
                button.style.background = '#333333';
                button.disabled = true;
            }
        }

        // Admin functions
        function addEvent() {
            showToast('Add Event modal would appear here', 'info');
        }

        function viewRoster(eventId) {
            showToast('Roster drawer would slide out showing creator status', 'info');
        }

        function editEvent(eventId) {
            showToast('Event editor modal would appear here', 'info');
        }

        function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event?')) {
                showToast('Event deleted successfully!', 'success');
            }
        }

        // UI update functions for dashboard header
        function updateDashboardHeader() {
            if (currentUser) {
                // Update header with user info
                const userSection = document.querySelector('.dashboard-header .logo + div');
                if (userSection) {
                    userSection.innerHTML = `
                        <button class="nav-button" style="background: #0066ff;">Events</button>
                        <button class="nav-button">Profile</button>
                        <div style="width: 40px; height: 40px; background: #0066ff; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: #ffffff; font-weight: 600;">${currentUser.name.charAt(0)}</div>
                    `;
                }
            }
        }

        // Admin Section Navigation
        function showAdminSection(section) {
            console.log('🔧 Showing admin section:', section);
            
            // Hide all sections
            const adminSections = document.querySelectorAll('.admin-section');
            const adminButtons = document.querySelectorAll('.admin-nav-button');
            
            console.log('📋 Available admin sections:', Array.from(adminSections).map(s => s.id));
            console.log('🔘 Available admin buttons:', adminButtons.length);
            
            adminSections.forEach(el => {
                el.classList.remove('active');
                console.log('📵 Hiding admin section:', el.id);
            });
            
            adminButtons.forEach(el => {
                el.classList.remove('active');
                console.log('🔘 Deactivating button:', el.textContent);
            });
            
            // Show selected section
            const targetSection = document.getElementById(`admin-${section}`);
            const targetButton = document.querySelector(`[onclick="showAdminSection('${section}')"]`);
            
            console.log('🎯 Target section found:', !!targetSection);
            console.log('🎯 Target button found:', !!targetButton);
            
            if (targetSection) {
                targetSection.classList.add('active');
                console.log('✅ Activated admin section:', `admin-${section}`);
            }
            
            if (targetButton) {
                targetButton.classList.add('active');
                console.log('✅ Activated admin button:', targetButton.textContent);
            }
            
            currentAdminSection = section;
            console.log('📝 Set current admin section to:', section);
            loadSectionData(section);
        }

        // Load section data
        async function loadSectionData(section) {
            console.log('📊 Loading section data for:', section);
            try {
                switch(section) {
                    case 'dashboard':
                        console.log('📈 Loading dashboard stats...');
                        await loadDashboardStats();
                        break;
                    case 'applications':
                        console.log('📋 Loading applications...');
                        await loadApplications();
                        break;
                    case 'members':
                        console.log('👥 Loading members...');
                        await loadMembers();
                        break;
                    case 'events':
                        console.log('🎉 Loading events...');
                        await loadEvents();
                        break;
                    default:
                        console.warn('⚠️ Unknown section:', section);
                }
                console.log('✅ Section data loaded successfully for:', section);
            } catch (error) {
                console.error('💥 Error loading section data:', error);
                showToast('Failed to load data. Please try again.', 'error');
            }
        }

        // Initialize admin console
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('🚀 DOM loaded, checking hash:', window.location.hash);
            console.log('🌐 Current URL:', window.location.href);
            
            // Check what pages are available
            const pages = document.querySelectorAll('.page');
            console.log('📄 Available pages on load:', Array.from(pages).map(p => p.id));
            
            // Check for admin elements
            const adminPage = document.getElementById('admin-page');
            const adminContainer = document.querySelector('.admin-container');
            const adminSections = document.querySelectorAll('.admin-section');
            
            console.log('🔧 Admin page element found:', !!adminPage);
            console.log('🔧 Admin container found:', !!adminContainer);
            console.log('🔧 Admin sections found:', adminSections.length);
            
            // Check authentication state first
            await checkAuthState();
            
            // Handle hash navigation
            if (window.location.hash === '#admin' || window.location.hash === '#admin-page') {
                console.log('🔧 Hash indicates admin page, showing admin-page');
                showPage('admin-page');
                setTimeout(() => {
                    showAdminSection('dashboard');
                }, 100);
            } else if (window.location.hash) {
                console.log('🔗 Hash found, showing page:', window.location.hash.substring(1));
                showPage(window.location.hash.substring(1));
            } else {
                console.log('🏠 No hash, showing landing page');
                showPage('landing');
            }
            
            // Test Supabase connection
            console.log('🔗 Testing Supabase connection...');
            testSupabaseConnection();
        });

        // Test function to verify Supabase connection
        async function testSupabaseConnection() {
            try {
                console.log('🔗 Testing Supabase connection...');
                console.log('📊 Supabase client:', supabaseClient);
                console.log('📊 Client type:', typeof supabaseClient);
                
                if (!supabaseClient) {
                    throw new Error('Supabase client not initialized');
                }
                
                // Test all tables
                console.log('📡 Testing all database tables...');
                const tableTests = await Promise.allSettled([
                    supabaseClient.from('events').select('*', { count: 'exact', head: true }),
                    supabaseClient.from('applications').select('*', { count: 'exact', head: true }),
                    supabaseClient.from('profiles').select('*', { count: 'exact', head: true }),
                    supabaseClient.from('newsletter_subscribers').select('*', { count: 'exact', head: true })
                ]);
                
                const tableNames = ['events', 'applications', 'profiles', 'newsletter_subscribers'];
                tableTests.forEach((result, index) => {
                    const tableName = tableNames[index];
                    if (result.status === 'fulfilled') {
                        console.log(`✅ ${tableName} table: ${result.value.count || 0} records`);
                    } else {
                        console.error(`❌ ${tableName} table error:`, result.reason);
                    }
                });
                
                const failedTests = tableTests.filter(t => t.status === 'rejected');
                if (failedTests.length > 0) {
                    throw new Error(`${failedTests.length} table(s) failed connection test`);
                }
                
                console.log('✅ All database tables accessible');
                showToast('Database connected successfully', 'success');
            } catch (err) {
                console.error('💥 Supabase test failed:', err);
                showToast('Database connection failed: ' + err.message, 'error');
            }
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', async function() {
            // Create admin application automatically
            await createAdminApplicationOnLoad();
            
            // Add event listeners for guidelines checkbox
            const checkbox = document.getElementById('guidelinesCheck');
            const confirmButton = document.getElementById('confirmJoinButton');
            
            if (checkbox && confirmButton) {
                checkbox.addEventListener('change', function() {
                    confirmButton.disabled = !this.checked;
                });
            }

            // Add click handlers for event buttons
            document.querySelectorAll('.event-button').forEach(button => {
                if (button.textContent === 'Join') {
                    button.addEventListener('click', function() {
                        const eventCard = this.closest('.event-card');
                        const eventData = {
                            id: eventCard.dataset.eventId || '1',
                            venue: eventCard.querySelector('.venue-name').textContent,
                            hook: eventCard.querySelector('.event-hook').textContent
                        };
                        openJoinModal(eventData);
                    });
                }
            });

            // Add data attributes to event cards
            document.querySelectorAll('.event-card').forEach((card, index) => {
                card.dataset.eventId = (index + 1).toString();
            });

            // Add data attributes to table rows
            document.querySelectorAll('.table-row').forEach((row, index) => {
                row.dataset.eventId = (index + 1).toString();
            });
        });

        // Dashboard Functions
        async function loadDashboardStats() {
            console.log('Loading dashboard stats...');
            try {
                const results = await Promise.all([
                    supabaseClient.from('events').select('*', { count: 'exact', head: true }),
                    supabaseClient.from('applications').select('*', { count: 'exact', head: true }),
                    supabaseClient.from('profiles').select('*', { count: 'exact', head: true }),
                    supabaseClient.from('applications').select('*', { count: 'exact', head: true }).eq('status', 'pending')
                ]);

                console.log('Dashboard results:', results);

                const [
                    { count: totalEvents },
                    { count: totalApplications },
                    { count: totalMembers },
                    { count: pendingApplications }
                ] = results;

                console.log('Stats:', { totalEvents, totalApplications, totalMembers, pendingApplications });

                document.getElementById('total-events').textContent = totalEvents || 0;
                document.getElementById('total-members').textContent = totalMembers || 0;
                document.getElementById('pending-applications').textContent = pendingApplications || 0;
                document.getElementById('active-events').textContent = totalEvents || 0;
                
                showToast('Dashboard stats loaded successfully', 'success');
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                showToast('Failed to load dashboard stats: ' + error.message, 'error');
                
                // Set default values
                document.getElementById('total-events').textContent = '0';
                document.getElementById('total-members').textContent = '0';
                document.getElementById('pending-applications').textContent = '0';
                document.getElementById('active-events').textContent = '0';
            }
        }

        // Create Test Approved Application
        async function createTestApprovedApplication() {
            console.log('🧪 Creating test approved application...');
            
            try {
                const testApplication = {
                    full_name: 'Test Creator',
                    email: 'test@creator.com',
                    phone: '+1234567890',
                    instagram: '@testcreator',
                    follower_count: 15000,
                    content_category: 'Food & Lifestyle',
                    city: 'New York City',
                    motivation: 'I love discovering new places and sharing them with my community!',
                    status: 'approved',
                    reviewed_at: new Date().toISOString()
                };

                const { data, error } = await supabaseClient
                    .from('applications')
                    .insert([testApplication])
                    .select();

                if (error) {
                    console.error('❌ Error creating test application:', error);
                    throw error;
                }

                console.log('✅ Test approved application created:', data[0]);
                showToast('Test approved application created! You can now sign in with test@creator.com', 'success');
                return data[0];
            } catch (error) {
                console.error('❌ Error creating test application:', error);
                showToast('Failed to create test application: ' + error.message, 'error');
            }
        }

        // Create Admin Application (for hello@societyunlocked.com)
        async function createAdminApplication() {
            console.log('👑 Creating admin application...');
            
            try {
                const adminApplication = {
                    full_name: 'Society Unlocked Admin',
                    email: 'hello@societyunlocked.com',
                    phone: '+1234567890',
                    instagram: '@societyunlocked',
                    follower_count: 50000,
                    content_category: 'Business & Events',
                    city: 'New York City',
                    motivation: 'Managing the Society Unlocked platform and connecting venues with creators.',
                    status: 'approved',
                    reviewed_at: new Date().toISOString()
                };

                const { data, error } = await supabaseClient
                    .from('applications')
                    .insert([adminApplication])
                    .select();

                if (error) {
                    console.error('❌ Error creating admin application:', error);
                    throw error;
                }

                console.log('✅ Admin approved application created:', data[0]);
                showToast('Admin application created! You can now sign in with hello@societyunlocked.com and password 1234', 'success');
                return data[0];
            } catch (error) {
                console.error('❌ Error creating admin application:', error);
                showToast('Failed to create admin application: ' + error.message, 'error');
            }
        }

        // Automatically create admin application on page load
        async function createAdminApplicationOnLoad() {
            console.log('🔧 Checking for admin application...');
            
            try {
                // Check if admin application already exists
                const { data: existingApp, error: checkError } = await supabaseClient
                    .from('applications')
                    .select('id')
                    .eq('email', 'hello@societyunlocked.com')
                    .single();
                
                if (checkError && checkError.code !== 'PGRST116') {
                    console.error('❌ Error checking admin application:', checkError);
                    return;
                }
                
                if (existingApp) {
                    console.log('✅ Admin application already exists');
                } else {
                    // Create admin application if it doesn't exist
                    console.log('👑 Creating admin application automatically...');
                    await createAdminApplication();
                }
                
                // Also create a test application for demo purposes
                const { data: testApp, error: testCheckError } = await supabaseClient
                    .from('applications')
                    .select('id')
                    .eq('email', 'test@creator.com')
                    .single();
                
                if (testCheckError && testCheckError.code !== 'PGRST116') {
                    console.error('❌ Error checking test application:', testCheckError);
                    return;
                }
                
                if (!testApp) {
                    console.log('🧪 Creating test application automatically...');
                    await createTestApprovedApplication();
                } else {
                    console.log('✅ Test application already exists');
                }
                
            } catch (error) {
                console.error('❌ Error in createAdminApplicationOnLoad:', error);
            }
        }

        // Create Test Events with Future Dates
        async function createTestEvents() {
            console.log('🧪 Creating test events...');
            
            try {
                const today = new Date();
                const testEvents = [
                    {
                        venue: 'The Grand',
                        hook: 'Exclusive rooftop party with NYC influencers',
                        date: new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString(), // 1 week from now
                        capacity: 50,
                        description: 'Join us for an exclusive evening of networking and celebration',
                        location_address: '123 Grand St, New York, NY 10013',
                        status: 'active'
                    },
                    {
                        venue: 'Skyline Lounge',
                        hook: 'Sunset cocktails and city views',
                        date: new Date(today.getTime() + 14 * 24 * 60 * 60 * 1000).toISOString(), // 2 weeks from now
                        capacity: 30,
                        description: 'Experience the best sunset views in Manhattan',
                        location_address: '456 Sky Ave, New York, NY 10001',
                        status: 'active'
                    },
                    {
                        venue: 'Underground',
                        hook: 'Late night beats and underground vibes',
                        date: new Date(today.getTime() + 21 * 24 * 60 * 60 * 1000).toISOString(), // 3 weeks from now
                        capacity: 75,
                        description: 'The hottest underground party in the city',
                        location_address: '789 Underground Blvd, New York, NY 10002',
                        status: 'active'
                    }
                ];

                const { data, error } = await supabaseClient
                    .from('events')
                    .insert(testEvents)
                    .select();

                if (error) {
                    console.error('❌ Error creating test events:', error);
                    throw error;
                }

                console.log('✅ Test events created:', data.length, 'events');
                showToast(`${data.length} test events created successfully!`, 'success');
                
                // Reload dashboard events if we're on the dashboard
                if (document.getElementById('dashboard').classList.contains('active')) {
                    loadDashboardEvents();
                }
                
                return data;
            } catch (error) {
                console.error('❌ Error creating test events:', error);
                showToast('Failed to create test events: ' + error.message, 'error');
            }
        }

        // Load Dashboard Events
        async function loadDashboardEvents() {
            console.log('🎯 Loading dashboard events...');
            try {
                // First, try to get all active events (including past ones for testing)
                const { data: events, error } = await supabaseClient
                    .from('events')
                    .select('*')
                    .eq('status', 'active')
                    .order('date', { ascending: true });

                if (error) {
                    console.error('❌ Error loading dashboard events:', error);
                    throw error;
                }
                
                console.log('✅ Dashboard events loaded:', events.length, 'events');
                console.log('📅 Events data:', events);

                const eventsGrid = document.querySelector('.events-grid');
                
                if (events.length === 0) {
                    eventsGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #666666;">
                            <p>No active events available at the moment.</p>
                            <p>Check back soon for new opportunities!</p>
                            <button onclick="createTestEvents()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #0066ff; color: white; border: none; border-radius: 4px; cursor: pointer;">Create Test Events</button>
                            <button onclick="createTestApprovedApplication()" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: #00cc66; color: white; border: none; border-radius: 4px; cursor: pointer;">Create Test User</button>
                        </div>
                    `;
                    return;
                }

                eventsGrid.innerHTML = events.map(event => {
                    const eventDate = new Date(event.date);
                    const currentParticipants = event.current_participants || 0;
                    const capacity = event.capacity || 0;
                    const spotsLeft = capacity - currentParticipants;
                    const capacityPercentage = capacity > 0 ? (currentParticipants / capacity) * 100 : 0;
                    
                    let buttonText = 'Join';
                    let buttonStyle = '';
                    let buttonDisabled = '';
                    
                    if (spotsLeft <= 0) {
                        buttonText = 'Full';
                        buttonStyle = 'background: #666666;';
                        buttonDisabled = 'disabled';
                    }
                    
                    return `
                        <div class="event-card" data-event-id="${event.id}">
                            <div class="event-image">${event.venue}</div>
                            <div class="event-content">
                                <h3 class="venue-name">${event.venue}</h3>
                                <p class="event-hook">${event.hook}</p>
                                <div class="event-date" style="color: #666666; font-size: 0.9rem; margin-bottom: 0.5rem;">
                                    ${eventDate.toLocaleDateString()} at ${eventDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                </div>
                                <div class="capacity-meter">
                                    <span class="capacity-text">${spotsLeft}/${capacity} spots left</span>
                                    <div class="capacity-bar">
                                        <div class="capacity-fill" style="width: ${capacityPercentage}%; background: ${capacityPercentage >= 80 ? '#ff4444' : capacityPercentage >= 60 ? '#ffaa00' : '#00cc66'};"></div>
                                    </div>
                                </div>
                                <button class="event-button" ${buttonDisabled} style="${buttonStyle}" onclick="handleJoinEvent(${event.id})">${buttonText}</button>
                            </div>
                        </div>
                    `;
                }).join('');

                console.log('✅ Dashboard events rendered successfully');
            } catch (error) {
                console.error('❌ Error loading dashboard events:', error);
                showToast('Failed to load events: ' + error.message, 'error');
                
                // Show fallback message
                const eventsGrid = document.querySelector('.events-grid');
                eventsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #ff4444;">
                        <p>Failed to load events. Please try again later.</p>
                        <button onclick="loadDashboardEvents()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #0066ff; color: white; border: none; border-radius: 4px; cursor: pointer;">Retry</button>
                    </div>
                `;
            }
        }

        // Handle Join Event
        async function handleJoinEvent(eventId) {
            console.log('🎯 Joining event:', eventId);
            
            try {
                const { data: event, error } = await supabaseClient
                    .from('events')
                    .select('*')
                    .eq('id', eventId)
                    .single();

                if (error) throw error;

                // For now, just show the join modal with event data
                const eventData = {
                    id: eventId,
                    venue: event.venue,
                    hook: event.hook
                };
                
                openJoinModal(eventData);
            } catch (error) {
                console.error('❌ Error joining event:', error);
                showToast('Failed to join event: ' + error.message, 'error');
            }
        }

        // Applications Functions
        async function loadApplications() {
            try {
                console.log('📋 Loading applications...');
                
                // Check if user is admin first
                const { data: { user }, error: authError } = await supabaseClient.auth.getUser();
                
                if (authError || !user) {
                    console.log('❌ Not authenticated, cannot load applications');
                    showToast('Please sign in to view applications', 'error');
                    return;
                }
                
                const { data: applications, error } = await supabaseClient
                    .from('applications')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('❌ Error loading applications:', error);
                    if (error.message.includes('row-level security policy')) {
                        showToast('Access denied. You need admin privileges. Run makeCurrentUserAdmin() in console.', 'error');
                        console.log('💡 To become admin, run: makeCurrentUserAdmin()');
                        return;
                    }
                    throw error;
                }
                
                console.log('✅ Applications loaded:', applications.length, 'applications');

                const applicationsList = document.getElementById('applications-list');
                applicationsList.innerHTML = applications.map(app => `
                    <div class="application-card">
                        <div class="application-header">
                            <div class="application-name">${app.full_name}</div>
                            <div class="application-status ${app.status}">${app.status}</div>
                        </div>
                        <div class="application-details">
                            <div class="application-detail">
                                <strong>Email:</strong> ${app.email}
                            </div>
                            <div class="application-detail">
                                <strong>Instagram:</strong> ${app.instagram}
                            </div>
                            <div class="application-detail">
                                <strong>Followers:</strong> ${app.follower_count}
                            </div>
                            <div class="application-detail">
                                <strong>Category:</strong> ${app.content_category}
                            </div>
                            <div class="application-detail">
                                <strong>City:</strong> ${app.city}
                            </div>
                        </div>
                        <div class="application-actions">
                            <button class="review-button" onclick="openApplicationModal(${app.id})">Review</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('❌ Error loading applications:', error);
                showToast('Failed to load applications: ' + error.message, 'error');
            }
        }

        async function filterApplications() {
            const status = document.getElementById('application-filter').value;
            try {
                const query = supabaseClient.from('applications').select('*');
                if (status !== 'all') {
                    query.eq('status', status);
                }
                const { data: applications, error } = await query.order('created_at', { ascending: false });

                if (error) throw error;

                const applicationsList = document.getElementById('applications-list');
                applicationsList.innerHTML = applications.map(app => `
                    <div class="application-card">
                        <div class="application-header">
                            <div class="application-name">${app.full_name}</div>
                            <div class="application-status ${app.status}">${app.status}</div>
                        </div>
                        <div class="application-details">
                            <div class="application-detail">
                                <strong>Email:</strong> ${app.email}
                            </div>
                            <div class="application-detail">
                                <strong>Instagram:</strong> ${app.instagram}
                            </div>
                            <div class="application-detail">
                                <strong>Followers:</strong> ${app.follower_count}
                            </div>
                            <div class="application-detail">
                                <strong>Category:</strong> ${app.content_category}
                            </div>
                            <div class="application-detail">
                                <strong>City:</strong> ${app.city}
                            </div>
                        </div>
                        <div class="application-actions">
                            <button class="review-button" onclick="openApplicationModal(${app.id})">Review</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error filtering applications:', error);
                showToast('Failed to filter applications', 'error');
            }
        }

        // Application Review Modal Functions
        let currentApplicationId = null;

        async function openApplicationModal(applicationId) {
            currentApplicationId = applicationId;
            const modal = document.getElementById('applicationModal');
            
            try {
                const { data: application, error } = await supabaseClient
                    .from('applications')
                    .select('*')
                    .eq('id', applicationId)
                    .single();

                if (error) throw error;

                const applicationDetails = document.getElementById('application-details');
                applicationDetails.innerHTML = `
                    <div class="application-details">
                        <div class="application-detail">
                            <strong>Name:</strong> ${application.full_name}
                        </div>
                        <div class="application-detail">
                            <strong>Email:</strong> ${application.email}
                        </div>
                        <div class="application-detail">
                            <strong>Instagram:</strong> ${application.instagram}
                        </div>
                        <div class="application-detail">
                            <strong>Followers:</strong> ${application.follower_count}
                        </div>
                        <div class="application-detail">
                            <strong>Category:</strong> ${application.content_category}
                        </div>
                        <div class="application-detail">
                            <strong>City:</strong> ${application.city}
                        </div>
                        <div class="application-detail">
                            <strong>Motivation:</strong><br>${application.motivation}
                        </div>
                    </div>
                `;

                modal.style.display = 'block';
            } catch (error) {
                console.error('Error loading application details:', error);
                showToast('Failed to load application details', 'error');
            }
        }

        function closeApplicationModal() {
            document.getElementById('applicationModal').style.display = 'none';
            document.getElementById('review-notes').value = '';
            currentApplicationId = null;
        }

        async function approveApplication() {
            if (!currentApplicationId) return;
            
            try {
                // Check if user is admin first
                const { data: { user }, error: authError } = await supabaseClient.auth.getUser();
                
                if (authError || !user) {
                    showToast('Please sign in to approve applications', 'error');
                    return;
                }
                
                // Get current user profile to check admin status
                const { data: profile, error: profileError } = await supabaseClient
                    .from('profiles')
                    .select('is_admin')
                    .eq('id', user.id)
                    .single();
                
                if (profileError) {
                    console.error('❌ Error checking admin status:', profileError);
                    showToast('Error checking admin permissions', 'error');
                    return;
                }
                
                if (!profile || !profile.is_admin) {
                    showToast('You need admin privileges to approve applications. Run makeCurrentUserAdmin() in console.', 'error');
                    console.log('💡 To become admin, run: makeCurrentUserAdmin()');
                    return;
                }
                
                console.log('✅ User has admin privileges, proceeding with approval...');
                
                const reviewNotes = document.getElementById('review-notes').value;
                const { error } = await supabaseClient
                    .from('applications')
                    .update({
                        status: 'approved',
                        review_notes: reviewNotes,
                        reviewed_at: new Date().toISOString(),
                        reviewed_by: user.id
                    })
                    .eq('id', currentApplicationId);

                if (error) {
                    console.error('❌ Database error approving application:', error);
                    throw error;
                }

                showToast('Application approved successfully', 'success');
                closeApplicationModal();
                loadApplications();
                loadDashboardStats(); // Refresh stats
            } catch (error) {
                console.error('Error approving application:', error);
                if (error.message.includes('new row violates row-level security policy')) {
                    showToast('Permission denied. You need admin privileges. Run makeCurrentUserAdmin() in console.', 'error');
                } else {
                    showToast('Failed to approve application: ' + error.message, 'error');
                }
            }
        }

        async function denyApplication() {
            if (!currentApplicationId) return;
            
            try {
                // Check if user is admin first
                const { data: { user }, error: authError } = await supabaseClient.auth.getUser();
                
                if (authError || !user) {
                    showToast('Please sign in to deny applications', 'error');
                    return;
                }
                
                // Get current user profile to check admin status
                const { data: profile, error: profileError } = await supabaseClient
                    .from('profiles')
                    .select('is_admin')
                    .eq('id', user.id)
                    .single();
                
                if (profileError) {
                    console.error('❌ Error checking admin status:', profileError);
                    showToast('Error checking admin permissions', 'error');
                    return;
                }
                
                if (!profile || !profile.is_admin) {
                    showToast('You need admin privileges to deny applications. Run makeCurrentUserAdmin() in console.', 'error');
                    console.log('💡 To become admin, run: makeCurrentUserAdmin()');
                    return;
                }
                
                console.log('✅ User has admin privileges, proceeding with denial...');
                
                const reviewNotes = document.getElementById('review-notes').value;
                const { error } = await supabaseClient
                    .from('applications')
                    .update({
                        status: 'denied',
                        review_notes: reviewNotes,
                        reviewed_at: new Date().toISOString(),
                        reviewed_by: user.id
                    })
                    .eq('id', currentApplicationId);

                if (error) {
                    console.error('❌ Database error denying application:', error);
                    throw error;
                }

                showToast('Application denied successfully', 'success');
                closeApplicationModal();
                loadApplications();
                loadDashboardStats(); // Refresh stats
            } catch (error) {
                console.error('Error denying application:', error);
                if (error.message.includes('new row violates row-level security policy')) {
                    showToast('Permission denied. You need admin privileges. Run makeCurrentUserAdmin() in console.', 'error');
                } else {
                    showToast('Failed to deny application: ' + error.message, 'error');
                }
            }
        }

        // Members Functions
        async function loadMembers() {
            try {
                console.log('👥 Loading members...');
                const { data: members, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('❌ Error loading members:', error);
                    throw error;
                }
                
                console.log('✅ Members loaded:', members.length, 'members');

                const membersList = document.getElementById('members-list');
                membersList.innerHTML = members.map(member => `
                    <div class="member-card">
                        <div class="member-info">
                            <div class="member-avatar">${member.full_name.charAt(0)}</div>
                            <div class="member-details">
                                <h3>${member.full_name}</h3>
                                <p>${member.instagram_handle} • ${member.city}</p>
                            </div>
                        </div>
                        <div class="member-actions">
                            <button class="action-button" onclick="viewMemberProfile(${member.id})">View Profile</button>
                            ${member.is_banned ? 
                                `<button class="ban-button" onclick="toggleBan('${member.id}', false)">Unban</button>` :
                                `<button class="ban-button" onclick="toggleBan('${member.id}', true)">Ban</button>`
                            }
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading members:', error);
                showToast('Failed to load members', 'error');
            }
        }

        async function searchMembers() {
            const searchTerm = document.getElementById('member-search').value.toLowerCase();
            try {
                const { data: members, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .or(`full_name.ilike.%${searchTerm}%,instagram_handle.ilike.%${searchTerm}%,city.ilike.%${searchTerm}%`)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const membersList = document.getElementById('members-list');
                membersList.innerHTML = members.map(member => `
                    <div class="member-card">
                        <div class="member-info">
                            <div class="member-avatar">${member.full_name.charAt(0)}</div>
                            <div class="member-details">
                                <h3>${member.full_name}</h3>
                                <p>${member.instagram_handle} • ${member.city}</p>
                            </div>
                        </div>
                        <div class="member-actions">
                            <button class="action-button" onclick="viewMemberProfile(${member.id})">View Profile</button>
                            ${member.is_banned ? 
                                `<button class="ban-button" onclick="toggleBan('${member.id}', false)">Unban</button>` :
                                `<button class="ban-button" onclick="toggleBan('${member.id}', true)">Ban</button>`
                            }
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error searching members:', error);
                showToast('Failed to search members', 'error');
            }
        }

        async function toggleBan(userId, isBanned) {
            try {
                const { error } = await supabaseClient
                    .from('profiles')
                    .update({ is_banned: isBanned })
                    .eq('id', userId);

                if (error) throw error;

                showToast(`User ${isBanned ? 'banned' : 'unbanned'} successfully`, 'success');
                loadMembers();
            } catch (error) {
                console.error('Error toggling ban status:', error);
                showToast('Failed to update ban status', 'error');
            }
        }

        // Events Functions
        async function loadEvents() {
            try {
                console.log('🎉 Loading events...');
                const { data: events, error } = await supabaseClient
                    .from('events')
                    .select('*')
                    .order('date', { ascending: true });

                if (error) {
                    console.error('❌ Error loading events:', error);
                    throw error;
                }
                
                console.log('✅ Events loaded:', events.length, 'events');

                const eventsList = document.getElementById('events-list');
                eventsList.innerHTML = events.map(event => `
                    <div class="event-management-card">
                        <div class="event-management-header">
                            <div class="event-management-title">${event.venue}</div>
                            <div class="event-management-actions">
                                <button class="action-button" onclick="viewEventParticipants(${event.id})">View Roster</button>
                                <button class="action-button" onclick="editEvent(${event.id})">Edit</button>
                                <button class="action-button" onclick="deleteEvent(${event.id})">Delete</button>
                            </div>
                        </div>
                        <div class="event-management-details">
                            <div class="event-management-detail">
                                <strong>Hook:</strong> ${event.hook}
                            </div>
                            <div class="event-management-detail">
                                <strong>Date:</strong> ${new Date(event.date).toLocaleDateString()}
                            </div>
                            <div class="event-management-detail">
                                <strong>Capacity:</strong> ${event.current_participants}/${event.capacity}
                            </div>
                            <div class="event-management-detail">
                                <strong>Status:</strong> ${event.status}
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading events:', error);
                showToast('Failed to load events', 'error');
            }
        }

        // Event Modal Functions
        function openAddEventModal() {
            document.getElementById('addEventModal').style.display = 'block';
        }

        function closeAddEventModal() {
            document.getElementById('addEventModal').style.display = 'none';
        }

        async function submitNewEvent(event) {
            event.preventDefault();
            console.log('Form submitted');
            
            const formData = new FormData(event.target);
            const eventData = Object.fromEntries(formData);
            console.log('Form data:', eventData);
            
            // Manual validation
            const requiredFields = ['venue', 'hook', 'date', 'capacity', 'description', 'location_address'];
            const missingFields = requiredFields.filter(field => {
                const value = eventData[field];
                const isEmpty = !value || (typeof value === 'string' && value.trim() === '');
                console.log(`🔍 Field ${field}:`, value, 'isEmpty:', isEmpty);
                return isEmpty;
            });
            
            console.log('📝 Form validation - missing fields:', missingFields);
            console.log('📝 All form data:', eventData);
            
            if (missingFields.length > 0) {
                showToast(`Please fill in all required fields: ${missingFields.join(', ')}`, 'error');
                return;
            }
            
            try {
                console.log('Submitting to Supabase...');
                const { data, error } = await supabaseClient
                    .from('events')
                    .insert([{
                        venue: eventData.venue.trim(),
                        hook: eventData.hook.trim(),
                        date: eventData.date,
                        capacity: parseInt(eventData.capacity),
                        description: eventData.description.trim(),
                        location_address: eventData.location_address.trim(),
                        status: 'active'
                    }])
                    .select();

                console.log('Supabase response:', { data, error });

                if (error) throw error;

                showToast('Event created successfully', 'success');
                closeAddEventModal();
                event.target.reset(); // Reset the form
                loadEvents();
            } catch (error) {
                console.error('Error creating event:', error);
                showToast('Failed to create event: ' + error.message, 'error');
            }
        }

        // Event Participant Management
        async function viewEventParticipants(eventId) {
            try {
                const { data: participants, error } = await supabaseClient
                    .rpc('get_event_participants', { event_id_param: eventId });

                if (error) throw error;

                const modal = document.getElementById('eventParticipantsModal');
                const participantsList = document.getElementById('event-participants-list');
                
                participantsList.innerHTML = participants.map(participant => `
                    <div class="participant-card">
                        <div class="participant-info">
                            <div class="participant-avatar">${participant.full_name.charAt(0)}</div>
                            <div class="participant-details">
                                <h3>${participant.full_name}</h3>
                                <p>${participant.instagram_handle}</p>
                            </div>
                        </div>
                        <div class="participant-status">
                            <span class="status-badge ${participant.status}">${participant.status}</span>
                        </div>
                    </div>
                `).join('');

                modal.style.display = 'block';
            } catch (error) {
                console.error('Error loading event participants:', error);
                showToast('Failed to load event participants', 'error');
            }
        }

        async function editEvent(eventId) {
            try {
                const { data: event, error } = await supabaseClient
                    .from('events')
                    .select('*')
                    .eq('id', eventId)
                    .single();

                if (error) throw error;

                // Populate edit form
                const form = document.getElementById('editEventForm');
                form.elements['venue'].value = event.venue;
                form.elements['hook'].value = event.hook;
                form.elements['date'].value = event.date.split('T')[0];
                form.elements['capacity'].value = event.capacity;
                form.elements['description'].value = event.description;
                form.elements['location_address'].value = event.location_address;
                form.elements['status'].value = event.status;

                // Show edit modal
                document.getElementById('editEventModal').style.display = 'block';
            } catch (error) {
                console.error('Error loading event details:', error);
                showToast('Failed to load event details', 'error');
            }
        }

        async function updateEvent(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const eventData = Object.fromEntries(formData);
            
            try {
                const { error } = await supabaseClient
                    .from('events')
                    .update({
                        venue: eventData.venue,
                        hook: eventData.hook,
                        date: eventData.date,
                        capacity: parseInt(eventData.capacity),
                        description: eventData.description,
                        location_address: eventData.location_address,
                        status: eventData.status
                    })
                    .eq('id', eventData.id);

                if (error) throw error;

                showToast('Event updated successfully', 'success');
                document.getElementById('editEventModal').style.display = 'none';
                loadEvents();
            } catch (error) {
                console.error('Error updating event:', error);
                showToast('Failed to update event', 'error');
            }
        }

        async function deleteEvent(eventId) {
            if (!confirm('Are you sure you want to delete this event? This action cannot be undone.')) {
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('events')
                    .delete()
                    .eq('id', eventId);

                if (error) throw error;

                showToast('Event deleted successfully', 'success');
                loadEvents();
            } catch (error) {
                console.error('Error deleting event:', error);
                showToast('Failed to delete event', 'error');
            }
        }

        // Missing function implementations
        function viewMemberProfile(memberId) {
            // Placeholder for member profile viewing
            showToast('Member profile feature coming soon', 'info');
        }

        // Auth modal function is defined earlier in the file at line 1998

        // Helper function to navigate to admin
        function goToAdmin() {
            console.log('🔧 Navigating to admin page...');
            showPage('admin-page');
            showAdminSection('dashboard');
        }

        // Debug helper function
        async function debugApp() {
            console.log('🔍 === DEBUG INFORMATION ===');
            console.log('📊 Supabase Client:', supabaseClient);
            console.log('👤 Current User:', currentUser);
            console.log('🔧 Current Admin Section:', currentAdminSection);
            console.log('📄 Current Page:', document.querySelector('.page.active')?.id);
            console.log('🎯 Selected Event:', selectedEvent);
            
            // Check admin status
            try {
                const { data: { user }, error: authError } = await supabaseClient.auth.getUser();
                
                if (user) {
                    const { data: profile, error: profileError } = await supabaseClient
                        .from('profiles')
                        .select('is_admin, full_name')
                        .eq('id', user.id)
                        .single();
                    
                    if (profile) {
                        console.log('👑 Admin Status:', profile.is_admin ? '✅ ADMIN' : '❌ Not Admin');
                        console.log('🏷️ User Name:', profile.full_name);
                        if (!profile.is_admin) {
                            console.log('💡 To become admin, run: makeCurrentUserAdmin()');
                        }
                    } else {
                        console.log('❌ No profile found for user');
                    }
                } else {
                    console.log('📤 No authenticated user');
                }
            } catch (error) {
                console.error('❌ Error checking admin status:', error);
            }
            
            // Test all admin sections
            const adminSections = document.querySelectorAll('.admin-section');
            console.log('📋 Admin sections:', Array.from(adminSections).map(s => ({
                id: s.id,
                active: s.classList.contains('active'),
                visible: s.style.display !== 'none'
            })));
            
            // Test form elements
            const forms = document.querySelectorAll('form');
            console.log('📝 Forms found:', forms.length);
            
            // Test database connection
            testSupabaseConnection();
        }

        // Function to make current user admin (for testing)
        async function makeCurrentUserAdmin() {
            console.log('🔧 Making current user admin...');
            
            try {
                const { data: { user }, error: authError } = await supabaseClient.auth.getUser();
                
                if (authError || !user) {
                    showToast('Please sign in first', 'error');
                    return;
                }
                
                console.log('👤 Current user:', user.id);
                
                // Update user profile to make them admin
                const { error } = await supabaseClient
                    .from('profiles')
                    .update({ is_admin: true })
                    .eq('id', user.id);
                
                if (error) {
                    console.error('❌ Error making user admin:', error);
                    showToast('Failed to make user admin: ' + error.message, 'error');
                    return;
                }
                
                console.log('✅ User is now admin');
                showToast('You are now an admin! Refresh the page to see admin features.', 'success');
                
                // Update current user object
                if (currentUser) {
                    currentUser.profile.is_admin = true;
                }
                
            } catch (error) {
                console.error('❌ Error in makeCurrentUserAdmin:', error);
                showToast('Error making user admin: ' + error.message, 'error');
            }
        }

        // Make debug function available globally
        window.debugApp = debugApp;
        window.goToAdmin = goToAdmin;
        window.createTestApprovedApplication = createTestApprovedApplication;
        window.createAdminApplication = createAdminApplication;
        window.signOutUser = signOutUser;
        window.makeCurrentUserAdmin = makeCurrentUserAdmin;

        // Check authentication state on load
        async function checkAuthState() {
            console.log('🔐 Checking authentication state...');
            
            try {
                const { data: { user }, error } = await supabaseClient.auth.getUser();
                
                if (error) {
                    console.error('❌ Auth check error:', error);
                    return;
                }
                
                if (user) {
                    console.log('✅ User is authenticated:', user);
                    
                    // Get user profile
                    const profile = await getUserProfile(user.id);
                    
                    // Update last visit
                    await updateLastVisit(user.id);
                    
                    currentUser = {
                        id: user.id,
                        email: user.email,
                        name: profile.full_name || user.user_metadata?.full_name,
                        instagram: profile.instagram_handle,
                        profile: profile
                    };
                    
                    updateUserInterface();
                    console.log('✅ User session restored');
                } else {
                    console.log('📤 No authenticated user');
                }
            } catch (error) {
                console.error('❌ Error checking auth state:', error);
            }
        }

        // Add keyboard shortcut for admin access
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                console.log('🔧 Admin shortcut triggered (Ctrl+Shift+A)');
                goToAdmin();
            }
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                console.log('🔍 Debug shortcut triggered (Ctrl+Shift+D)');
                debugApp();
            }
        });
    </script>
</body>
</html> 